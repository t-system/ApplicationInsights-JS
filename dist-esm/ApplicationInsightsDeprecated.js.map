{"version":3,"file":"ApplicationInsightsDeprecated.js.map","sources":["ApplicationInsightsDeprecated.js"],"sourcesContent":["import { stringToBoolOrDefault, ProcessLegacy } from \"@microsoft/applicationinsights-common\";\nimport { proxyAssign, throwError } from \"@microsoft/applicationinsights-core-js\";\n// This is an exclude list of properties that should not be updated during initialization\n// They include a combination of private and internal property names\nvar _ignoreUpdateSnippetProperties = [\n    \"snippet\", \"getDefaultConfig\", \"_hasLegacyInitializers\", \"_queue\", \"_processLegacyInitializers\"\n];\n// ToDo: fix properties and measurements once updates are done to common\nvar AppInsightsDeprecated = /** @class */ (function () {\n    function AppInsightsDeprecated(snippet, appInsightsNew) {\n        this._hasLegacyInitializers = false;\n        this._queue = [];\n        this.config = AppInsightsDeprecated.getDefaultConfig(snippet.config);\n        this.appInsightsNew = appInsightsNew;\n        this.context = { addTelemetryInitializer: this.addTelemetryInitializers.bind(this) };\n    }\n    AppInsightsDeprecated.getDefaultConfig = function (config) {\n        if (!config) {\n            config = {};\n        }\n        // set default values\n        config.endpointUrl = config.endpointUrl || \"https://dc.services.visualstudio.com/v2/track\";\n        config.sessionRenewalMs = 30 * 60 * 1000;\n        config.sessionExpirationMs = 24 * 60 * 60 * 1000;\n        config.maxBatchSizeInBytes = config.maxBatchSizeInBytes > 0 ? config.maxBatchSizeInBytes : 102400; // 100kb\n        config.maxBatchInterval = !isNaN(config.maxBatchInterval) ? config.maxBatchInterval : 15000;\n        config.enableDebug = stringToBoolOrDefault(config.enableDebug);\n        config.disableExceptionTracking = stringToBoolOrDefault(config.disableExceptionTracking);\n        config.disableTelemetry = stringToBoolOrDefault(config.disableTelemetry);\n        config.verboseLogging = stringToBoolOrDefault(config.verboseLogging);\n        config.emitLineDelimitedJson = stringToBoolOrDefault(config.emitLineDelimitedJson);\n        config.diagnosticLogInterval = config.diagnosticLogInterval || 10000;\n        config.autoTrackPageVisitTime = stringToBoolOrDefault(config.autoTrackPageVisitTime);\n        if (isNaN(config.samplingPercentage) || config.samplingPercentage <= 0 || config.samplingPercentage >= 100) {\n            config.samplingPercentage = 100;\n        }\n        config.disableAjaxTracking = stringToBoolOrDefault(config.disableAjaxTracking);\n        config.maxAjaxCallsPerView = !isNaN(config.maxAjaxCallsPerView) ? config.maxAjaxCallsPerView : 500;\n        config.isBeaconApiDisabled = stringToBoolOrDefault(config.isBeaconApiDisabled, true);\n        config.disableCorrelationHeaders = stringToBoolOrDefault(config.disableCorrelationHeaders);\n        config.correlationHeaderExcludedDomains = config.correlationHeaderExcludedDomains || [\n            \"*.blob.core.windows.net\",\n            \"*.blob.core.chinacloudapi.cn\",\n            \"*.blob.core.cloudapi.de\",\n            \"*.blob.core.usgovcloudapi.net\"\n        ];\n        config.disableFlushOnBeforeUnload = stringToBoolOrDefault(config.disableFlushOnBeforeUnload);\n        config.disableFlushOnUnload = stringToBoolOrDefault(config.disableFlushOnUnload, config.disableFlushOnBeforeUnload);\n        config.enableSessionStorageBuffer = stringToBoolOrDefault(config.enableSessionStorageBuffer, true);\n        config.isRetryDisabled = stringToBoolOrDefault(config.isRetryDisabled);\n        config.isCookieUseDisabled = stringToBoolOrDefault(config.isCookieUseDisabled);\n        config.isStorageUseDisabled = stringToBoolOrDefault(config.isStorageUseDisabled);\n        config.isBrowserLinkTrackingEnabled = stringToBoolOrDefault(config.isBrowserLinkTrackingEnabled);\n        config.enableCorsCorrelation = stringToBoolOrDefault(config.enableCorsCorrelation);\n        return config;\n    };\n    /**\n     * The array of telemetry initializers to call before sending each telemetry item.\n     */\n    AppInsightsDeprecated.prototype.addTelemetryInitializers = function (callBack) {\n        var _this = this;\n        // Add initializer to current processing only if there is any old telemetry initializer\n        if (!this._hasLegacyInitializers) {\n            this.appInsightsNew.addTelemetryInitializer(function (item) {\n                _this._processLegacyInitializers(item); // setup call back for each legacy processor\n            });\n            this._hasLegacyInitializers = true;\n        }\n        this._queue.push(callBack);\n    };\n    /**\n     * Get the current cookie manager for this instance\n     */\n    AppInsightsDeprecated.prototype.getCookieMgr = function () {\n        return this.appInsightsNew.getCookieMgr();\n    };\n    AppInsightsDeprecated.prototype.startTrackPage = function (name) {\n        this.appInsightsNew.startTrackPage(name);\n    };\n    AppInsightsDeprecated.prototype.stopTrackPage = function (name, url, properties, measurements) {\n        this.appInsightsNew.stopTrackPage(name, url, properties); // update\n    };\n    AppInsightsDeprecated.prototype.trackPageView = function (name, url, properties, measurements, duration) {\n        var telemetry = {\n            name: name,\n            uri: url,\n            properties: properties,\n            measurements: measurements\n        };\n        // fix for props, measurements, duration\n        this.appInsightsNew.trackPageView(telemetry);\n    };\n    AppInsightsDeprecated.prototype.trackEvent = function (name, properties, measurements) {\n        this.appInsightsNew.trackEvent({ name: name });\n    };\n    AppInsightsDeprecated.prototype.trackDependency = function (id, method, absoluteUrl, pathName, totalTime, success, resultCode) {\n        this.appInsightsNew.trackDependencyData({\n            id: id,\n            target: absoluteUrl,\n            type: pathName,\n            duration: totalTime,\n            properties: { HttpMethod: method },\n            success: success,\n            responseCode: resultCode\n        });\n    };\n    AppInsightsDeprecated.prototype.trackException = function (exception, handledAt, properties, measurements, severityLevel) {\n        this.appInsightsNew.trackException({\n            exception: exception\n        });\n    };\n    AppInsightsDeprecated.prototype.trackMetric = function (name, average, sampleCount, min, max, properties) {\n        this.appInsightsNew.trackMetric({ name: name, average: average, sampleCount: sampleCount, min: min, max: max });\n    };\n    AppInsightsDeprecated.prototype.trackTrace = function (message, properties, severityLevel) {\n        this.appInsightsNew.trackTrace({ message: message, severityLevel: severityLevel });\n    };\n    AppInsightsDeprecated.prototype.flush = function (async) {\n        this.appInsightsNew.flush(async);\n    };\n    AppInsightsDeprecated.prototype.setAuthenticatedUserContext = function (authenticatedUserId, accountId, storeInCookie) {\n        this.appInsightsNew.context.user.setAuthenticatedUserContext(authenticatedUserId, accountId, storeInCookie);\n    };\n    AppInsightsDeprecated.prototype.clearAuthenticatedUserContext = function () {\n        this.appInsightsNew.context.user.clearAuthenticatedUserContext();\n    };\n    AppInsightsDeprecated.prototype._onerror = function (message, url, lineNumber, columnNumber, error) {\n        this.appInsightsNew._onerror({ message: message, url: url, lineNumber: lineNumber, columnNumber: columnNumber, error: error });\n    };\n    AppInsightsDeprecated.prototype.startTrackEvent = function (name) {\n        this.appInsightsNew.startTrackEvent(name);\n    };\n    AppInsightsDeprecated.prototype.stopTrackEvent = function (name, properties, measurements) {\n        this.appInsightsNew.stopTrackEvent(name, properties, measurements);\n    };\n    AppInsightsDeprecated.prototype.downloadAndSetup = function (config) {\n        throwError(\"downloadAndSetup not implemented in web SKU\");\n    };\n    AppInsightsDeprecated.prototype.updateSnippetDefinitions = function (snippet) {\n        // apply full appInsights to the global instance\n        // Note: This must be called before loadAppInsights is called\n        proxyAssign(snippet, this, function (name) {\n            // Not excluding names prefixed with \"_\" as we need to proxy some functions like _onError\n            return name && _ignoreUpdateSnippetProperties.indexOf(name) === -1;\n        });\n    };\n    // note: these are split into methods to enable unit tests\n    AppInsightsDeprecated.prototype.loadAppInsights = function () {\n        // initialize global instance of appInsights\n        // var appInsights = new Microsoft.ApplicationInsights.AppInsights(this.config);\n        var _this = this;\n        // implement legacy version of trackPageView for 0.10<\n        if (this.config[\"iKey\"]) {\n            var originalTrackPageView_1 = this.trackPageView;\n            this.trackPageView = function (pagePath, properties, measurements) {\n                originalTrackPageView_1.apply(_this, [null, pagePath, properties, measurements]);\n            };\n        }\n        // implement legacy pageView interface if it is present in the snippet\n        var legacyPageView = \"logPageView\";\n        if (typeof this.snippet[legacyPageView] === \"function\") {\n            this[legacyPageView] = function (pagePath, properties, measurements) {\n                _this.trackPageView(null, pagePath, properties, measurements);\n            };\n        }\n        // implement legacy event interface if it is present in the snippet\n        var legacyEvent = \"logEvent\";\n        if (typeof this.snippet[legacyEvent] === \"function\") {\n            this[legacyEvent] = function (name, props, measurements) {\n                _this.trackEvent(name, props, measurements);\n            };\n        }\n        return this;\n    };\n    AppInsightsDeprecated.prototype._processLegacyInitializers = function (item) {\n        // instead of mapping new to legacy and then back again and repeating in channel, attach callback for channel to call\n        item.tags[ProcessLegacy] = this._queue;\n        return item;\n    };\n    return AppInsightsDeprecated;\n}());\nexport { AppInsightsDeprecated };\n//# sourceMappingURL=ApplicationInsightsDeprecated.js.map"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}